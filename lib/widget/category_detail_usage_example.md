# 左侧分类右侧详情联动列表使用说明

## 功能特性

1. **左右联动**: 左侧分类列表和右侧详情列表自动联动
2. **滚动回调**: 右侧滚动到不同分类时，会触发回调通知外层
3. **点击跳转**: 点击左侧分类，右侧自动滚动到对应位置
4. **自动高亮**: 右侧滚动时，左侧自动高亮当前分类
5. **无第三方依赖**: 纯 Flutter 原生实现

## 使用方法

### 基础使用

```dart
CategoryDetailListView(
  onCategoryChanged: (index, name) {
    print('当前分类: $name (索引: $index)');
  },
)
```

### 自定义数据

在 `_CategoryDetailListViewState` 中修改 `_categories` 列表：

```dart
final List<CategoryData> _categories = [
  CategoryData(name: '分类1', items: ['商品1', '商品2']),
  CategoryData(name: '分类2', items: ['商品3', '商品4']),
  // ... 更多分类
];
```

## 核心实现原理

### 1. 位置计算
- 在初始化时计算每个分类在右侧列表中的起始位置
- 存储在 `_categoryPositions` 列表中

### 2. 滚动监听
- 监听右侧列表的滚动事件
- 根据滚动位置判断当前显示的分类
- 更新左侧选中状态并触发回调

### 3. 点击跳转
- 点击左侧分类时，标记为用户触发的滚动
- 右侧列表滚动到对应位置
- 滚动完成后恢复自动监听

### 4. 防止循环触发
- 使用 `_isClickScroll` 标志位
- 区分用户点击和自动滚动
- 避免回调被重复触发

## 回调说明

```dart
onCategoryChanged: (int categoryIndex, String categoryName) {
  // categoryIndex: 当前分类的索引，从0开始
  // categoryName: 当前分类的名称
  
  // 你可以在这里做任何需要的操作，例如：
  // - 更新外部状态
  // - 发送统计数据
  // - 加载更多数据
  // - 显示浮层提示
}
```

## 性能优化

1. **懒加载**: 使用 ListView.builder 实现按需渲染
2. **位置缓存**: 预计算分类位置，避免重复计算
3. **平滑滚动**: 使用 animateTo 提供流畅的滚动体验
4. **防抖处理**: 通过标志位避免频繁的回调触发

## 可扩展功能

### 1. 加载更多数据
在回调中检测到滚动到最后一个分类时，可以触发加载更多：

```dart
onCategoryChanged: (index, name) {
  if (index == categories.length - 1) {
    loadMoreCategories();
  }
}
```

### 2. 搜索高亮
可以添加搜索功能，根据关键词高亮匹配的商品

### 3. 分类统计
记录用户浏览各个分类的时长和次数

### 4. 自定义样式
修改分类项和商品项的构建方法，实现自定义UI

## 注意事项

1. 确保数据结构正确，避免空列表导致的布局问题
2. 如果分类或商品数量很多，考虑使用分页加载
3. 可以根据实际需求调整动画时长和滚动偏移量
4. 建议在实际使用时根据设计稿调整左侧分类列表的宽度

